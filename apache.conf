# Forge Service Delivery Portal - Apache Configuration
# Location: /etc/apache2/sites-available/forge-portal.conf (Debian/Ubuntu)
#           /etc/httpd/conf.d/forge-portal.conf (CentOS/RHEL)

<VirtualHost *:80>
    ServerName portal.forge.local
    ServerAlias forge-portal.local
    ServerAdmin admin@forge.local
    
    DocumentRoot /var/www/forge-portal
    DirectoryIndex index.html
    
    # Directory settings
    <Directory /var/www/forge-portal>
        Options -Indexes +FollowSymLinks -MultiViews
        AllowOverride All
        Require all granted
        
        # Optional: Basic authentication
        # AuthType Basic
        # AuthName "Forge Service Delivery Portal"
        # AuthUserFile /etc/apache2/.htpasswd
        # Require valid-user
    </Directory>
    
    # Security headers
    <IfModule mod_headers.c>
        Header always set X-Frame-Options "SAMEORIGIN"
        Header always set X-Content-Type-Options "nosniff"
        Header always set X-XSS-Protection "1; mode=block"
        Header always set Referrer-Policy "strict-origin-when-cross-origin"
        Header always set Content-Security-Policy "default-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' https://fonts.gstatic.com; img-src 'self' data:; script-src 'self' 'unsafe-inline';"
    </IfModule>
    
    # Compression
    <IfModule mod_deflate.c>
        AddOutputFilterByType DEFLATE text/html
        AddOutputFilterByType DEFLATE text/css
        AddOutputFilterByType DEFLATE text/javascript
        AddOutputFilterByType DEFLATE application/javascript
        AddOutputFilterByType DEFLATE application/json
        AddOutputFilterByType DEFLATE image/svg+xml
    </IfModule>
    
    # Cache control for static assets
    <IfModule mod_expires.c>
        ExpiresActive On
        ExpiresByType image/jpeg "access plus 7 days"
        ExpiresByType image/png "access plus 7 days"
        ExpiresByType image/gif "access plus 7 days"
        ExpiresByType image/svg+xml "access plus 7 days"
        ExpiresByType text/css "access plus 7 days"
        ExpiresByType application/javascript "access plus 7 days"
        ExpiresByType font/woff2 "access plus 7 days"
    </IfModule>
    
    # Deny access to hidden files
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/forge-portal-error.log
    CustomLog ${APACHE_LOG_DIR}/forge-portal-access.log combined
    LogLevel warn
</VirtualHost>

# HTTPS Configuration (uncomment when SSL certificate is available)
# <VirtualHost *:443>
#     ServerName portal.forge.local
#     ServerAdmin admin@forge.local
#     DocumentRoot /var/www/forge-portal
#     
#     SSLEngine on
#     SSLCertificateFile /etc/ssl/certs/forge-portal.crt
#     SSLCertificateKeyFile /etc/ssl/private/forge-portal.key
#     
#     # Modern SSL configuration
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256
#     SSLHonorCipherOrder off
#     
#     # HSTS
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#     
#     <Directory /var/www/forge-portal>
#         Options -Indexes +FollowSymLinks
#         AllowOverride All
#         Require all granted
#     </Directory>
#     
#     ErrorLog ${APACHE_LOG_DIR}/forge-portal-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/forge-portal-ssl-access.log combined
# </VirtualHost>

# Redirect HTTP to HTTPS (uncomment when SSL is configured)
# <VirtualHost *:80>
#     ServerName portal.forge.local
#     Redirect permanent / https://portal.forge.local/
# </VirtualHost>
